9/18/20:
X Updated the CRDMA CCDP testing documentation to reuse the data from CCDP test data scripts to simplify things
	X test that the CRDMA test cases still work with the CCDP automated test case data
X Finish compiling SOP information on CRDMA CDVM Testing Documentation.md using the CDVM testing and CRDMA CCDP testing documentation
	X finished verifying the CRDMA CDVM test cases on 9/18/20
X document update and commit code and documentation
X ** do a pull request for this one so I can verify that the markdown links are working correctly (ended up forking the repository and using the GitLab interface to verify the links were valid)


X update the cruise leg start/end date field comments to say in local timezone (don't want to use UTC for this)
	X work on updating the CCD to implement the timezone field in the views	
	X update the application to expose the timezone field (drop down with distinct TZNAME values)
		X allow offsets too? NO -> not sure how to generate those in the drop down field - look into this.  It would be best if we can use a query to validate the values
		_ QC for invalid timezone value





Version 1.0
	Tags: 
		CCD_data_integration_SOP_v1.2
		DB
		APEX app
		DVM
		VCM
		SQL Scripts (for role/permissions reports)
		


X update technical documentation to reference specific business rules defined in the sheet by their IDs (to make it easier to maintain the business rule documentation)

X document business rules:
	X CRDMA:
		X Only admins can update reference lists
		X Read and Write can view reference lists
		X write/admin can update insert/update/data sets
		X write/admin can update preset records
		X Write and admin can insert/update/delete cruises, cruise legs, data sets, and annotate validation issues

	X document in CCD (data_set_CAT_ID references the PARR Tools data set metadata record - CAT_ID)
		X data integration (PICDM.CAT_ID)
			X create views to pull 

X integration of PICDM objects:
	X CCD_LEG_DATA_SETS_V
	X CCD_DATA_SETS_INP_V
		

_ update CRDMA testing documentation to reflect the new CRDMA authorization policies


X document business rule for data set status display


	_ upgrade and rollback plan
		X dev
			X diff (using _TMP schema)
		test
			diff
		prod
			diff



APEX
	(document in X business rules, X APEX tech/user, and _ ** APEX testing documents)
	X Implement read role (view readonly for all non-admin pages)
	X Implement write role (read/write all non-admin pages)
	X Update navigation menu to allow read roles to access pages that have readonly access






_ (CCD) document approach reasoning for the wrapper table (use a table that already exists instead of creating something new) -> cite MOUSS as an example

X develop new function in CCD_CRUISE_PKG for translating cruise name to cruise_id (similar to cruise leg ID function)

X update the views to have a ccd_cruise_legs_v variation or just modify to add the delimited values for each leg
	X CCD_CRUISE_LEG_V (minimal)
	X CCD_CRUISE_LEG_AGG_V aggregates the cruise leg data to the cruise level to calculate things like DAS, start/end date, etc.
	X CCD_CRUISE_LEG_DELIM_V joins the delimited cruise and delimited cruise leg information 
	
	_ devise a good strategy for defining lean queries for performance but also having full queries for all reference tables and delimited lists, etc.

X make all unique character keys unique using the UPPER function? YES
	X ccd_leg_aliases
	X ccd_cruise_legs
	X ccd_cruises
	
	
	X CODE AND NAME:
		X CCD_DATA_SET_STATUS
		X CCD_DATA_SET_TYPES
		X CCD_DATA_SETS
		X CCD_EXP_SPP_CATS
		X CCD_GEAR
		X CCD_PLAT_TYPES
		X CCD_REG_ECOSYSTEMS
		X CCD_REGIONS
		X CCD_SCI_CENTER_DIVS
		X CCD_SCI_CENTERS
		X CCD_STD_SVY_NAMES
		X CCD_SVY_CATS
		X CCD_SVY_FREQ
		X CCD_SVY_TYPES
		X CCD_TGT_SPP_ESA
		X CCD_TGT_SPP_FSSI
		X CCD_TGT_SPP_MMPA
		X CCD_TGT_SPP_OTHER
		X CCD_VESSELS
		


_ document that other schemas should use UPPER() whenever translating them into the corresponding numeric keys

X document role definitions in business rules
	X Export the list of permissions associated with each role as a standard document?
		query: select * from role_tab_privs where OWNER = 'CEN_CRUISE' order by ROLE, TABLE_NAME, PRIVILEGE;

_ update documentation to align with MOUSS documentation:
	X db
	X tech apex documentation 
	X user apex documentation
	_ business rules
		X document CCD_CRUISE_PKG
		X document CCD_DVM_PKG
	X How To Configure Application.md
	


X update grant_external_schema_privs.sql to use the roles/privs granted to the MOUSS DB/app:
	X define synonyms for a typical integration data schema (e.g. MOUSS)
	_ update the cruise data integration SOP to reference the scripts
	_ update the general integration SOP to implement roles and synonyms as well and to cite the updated MOUSS DB and Cruise DB as example implementations




Version 1.1:


	DB:
		X Integrate the PICDM data set information into the centralized cruise DB (CAT_ID foreign key)
			? (Think about this)Update CCD_DATA_SETS.DATA_SET_ACCESS_URL to DATA_SET_ACCESS_INFO to provide instructions on how to access the data set internally (e.g. PIC.MOUSS schema, contact X for access)
			Pull the DOI, Archival URL from PICDM (ODS) into the CCD_DATA_SETS_V view
			Pull the publicly accessible and archived status from the PICDM schema (PARR Tools URL Verification Module results)
		Update CCD_DATA_SET_TYPES to rename DATA_SET_TYPE_DOC_URL to DATA_SET_TYPE_CAT_ID 
			Description: InPort Catalog ID for the data type, this should be the parent Project record of the individual data sets
			Update CCD_DATA_SETS_V to generate the DATA_SET_TYPE_INPORT_URL based on CAT_ID value (also allows the cruise-level data set types to be related to PICDM/ODS/InPort)
		_ do we want to have the cruise view have the cruise name aliases too?
			SE-19-06, SE1906, SE19-06, etc.? automatically generate this based on the vessel, fiscal year, and cruise number? (for historical purposes it has been called different things at different times
			Also, HA-12-01, HI-12-01

	APEX (Build out the data set interface):
		X Update interface to implement the data set information
		Update interface to display the datasets for each cruise leg/cruise with status displays (could put in a list)
			Add this to reports and form
		View Cruise -> Cruise Leg -> data sets report
	





Best Practice:
_ organize the views so the logic is not duplicated in multiple places (e.g. base views with _MIN prefix)
All delimited queries can be defined - do not duplicate tables either since it will increase the cost of the queries
	XX CCD_CRUISE_V - basic cruise with reference tables  (low cost)
	
	
	
	_ do we need a basic cruise view with just the leg aggregate values? NO, just include the vessel information too, it doesn't cost much
	XX CCD_CRUISE_AGG_V -> includes leg aggregate information (DAS, etc.)
	
	XX CCD_CRUISE_LEG_AGG_V -> includes leg aggregate information (not delimited leg values except for leg names, DAS, Cruise Start Date, etc.)
	
	
	XX CCD_LEG_V - basic leg with reference tables (low cost)

	XX CCD_CRUISE_LEG_V - basic cruise and leg with reference tables only  (low cost)


	
	XX CCD_CRUISE_DELIM_V - cruise-level only with all delimited/aggregated values
	XX CCD_LEG_DELIM_V - leg with all delimited/aggregated values
	
	XX CCD_CRUISE_LEG_DELIM_V - cruise and legs with all delimited/aggregate values for legs and cruises (separate rows for each leg)

	XX CCD_CRUISE_SUMM_V - cruise with delimited values and aggregated leg values - cruise-level only including aggregated leg values
	
	
	XX CCD_LEG_AGG_V - cruise leg aggregated information (CRUISE_DAS, NUM_LEGS, CRUISE_START_DATE, etc.)
	
	-- custom queries meant for external uses:
	cruise leg data sets 
		CCD_CRUISE_LEG_DATA_SETS_V
		CCD_CRUISE_LEG_DATA_SETS_MIN_V -> only CCD_CRUISE_AGG information and 




	X upgrade DVM to 1.5 and then update the cruise issue views to use the standard DVM view (DVM_













X define DB roles for CCD
	X document roles for CCD 
		X business rules
		X reference business rules in CCD DB documentation


	X Define and populate roles:
		X CCD_WRITE_ROLE - CCD read/write on all tables
		X CCD_READ_ROLE - CCD readonly on all tables/views
		X CCD_INTEG_ROLE - CCD integration - allows referencing of cruise tables and data integration (existing queries used on MOUSS DB and CTD DB)
		X CCD_ADMIN_ROLE - CCD read/write all tables and define/execute packages?
		X CCD_APP_ROLE - CCD APEX app privileges

X Add in accession numbers (ACCESSION_ID)? -> no, derive from PICDM schema



bugs:
	X login logo is not showing up


to do (DB version 1.0):
	X update the views to include the TZ offset in the cruise legs table and implement the logic to convert UTC to local time
		X also local time to UTC based on the TZ offset (this should defined in the centralized utilities schema to make it available to all data projects)
		
	APEX 
		X update the APEX interface to include the TZ offset 
		X update APEX app to implement cruise leg/data set relationship

		_ Document additional test cases and verify them

		X Implement all reference table management pages as interactive grids (8/11/23: still need to do Divisions)

	Data model
		X update views that depend on CCD_CRUISE_LEGS
		update data set - cruise leg relationship to be many to many
		X QC queries for TZ_NAME (must be in the list of values V$TIMEZONE_NAMES.TZNAME values)
			X update QC view
			X add to DVM
			X define test cases
			X document test cases (DVM Test Cases.xlsx)
			X verify test cases (automated verification)
			
		
		X update CCD_DATA_SETS to replace DATA_SET_INPORT_URL to DATA_SET_INPORT_CAT_ID
			X Update CCD_DATA_SETS_V to generate the DATA_SET_INPORT_URL based on CAT_ID value (also allows the cruise-level data sets to be related to PICDM/ODS/InPort)
		Add in any additional appropriate data elements from MOUSS DB

		Create a delimited view for leg data sets?
			Both ways? (comma-delimited list of leg ID/names for a given data set and a comma-delimited list of data set IDs/names for a given leg) YES
		Update data loading DML template and SQL scripts to populate the renamed numeric fields successfully
		
		X Add CRUD permissions to application schema on the CCD_LEG_DATA_SETS
		X Add synonyms to application schema

		X add/update history tracking package for appropriate CCD tables
			X document in DB documentation


		X update CCD_CCDP_DEEP_COPY_CMP_V view to include leg data set information
		X deep copy procedure needs to be updated to copy the leg data sets too
		X change all aggregate queries to NVL the num_X to 0 when null and update the code that checks for nulls to change it to zeroes (X also to add in new leg data set fields)
			X CCD_CRUISE_V
			X CCD_CRUISE_ISS_SUMM_V
			X CCD_CRUISE_SUMM_ISS_V
			X CCD_CRUISE_DELIM_V
			X CCD_CRUISE_SUMM_V
			X CCD_CRUISE_LEG_DELIM_V


		X update QC views to check for 0 instead of NULL for missing child records
			X CCD_QC_LEG_V
			X CCD_QC_CRUISE_V
			
			
		X identify APEX pages that need to have the leg data set aggregate info included

		X add leg data sets to DDL/DML generator document
			X export updated values to data set loading script
		
		
		QC criteria:
			X legs with no associated data sets
			X add to DVM
			X add to test cases
			X verify test cases
			X Update DVM test data (category 1 and 5) to set the new missing leg data sets errors
		
			
			
			
			
		X confirm MOUSS DB has all the information it needs in CEN_CRUISE to move forward before performing developer testing on CEN_CRUISE
			Look into:	
				X MOUSS_ARCH_INFO
				
		

		Documentation Updates:
			X DB Naming conventions
			X PL/SQL coding conventions
			X data model diagram
			Application documentation (page inventory)
				view/update data sets page
				interactive grid implementation for all reference table management pages
			business rules
			Testing documentation
			

	X View/Update reference table Pages:
		Vessels
		Regional Ecosystems
		Platform Types
		Survey Types
		Survey Categories
		Survey Frequencies
		ESA Target Species
		MMPA Target Species
		FSSI Target Species
		Standard Survey Names
		Science Centers
		Regions
		Gear
		Expected Species Categories
		Divisions


	business rules:
		X view/update data sets can be performed by DATA WRITE users
		





		DVM
			Add in QC criteria for the rest of the fields that were added/deleted
			

		X Pull data set information from PARR database (data set name based on CAT_ID)
			X developed views for this


		


	X use the CEN_UTIL_PKG 

X comment out package debugging comments


X check how the leg dates are being validated, does it actually work for date date types or just as a string comparison? (use explicit to_date conversion before comparison - look at SAM/CAS for how the validation is defined)
	ex: 06/20/2022 - 02/16/2023 

X update the update_DVM_IG_row_colors.js to use the PARR tools version (doesn't rely on result set field order)

DECLARE

	V_APP_CODE VARCHAR2(50);
	V_WRITE_ROLE_CODE VARCHAR2(50);
	V_ADMIN_ROLE_CODE VARCHAR2(50);
	V_CAS_ROLE_CODE_LIST VARCHAR2(2000);
	V_APP_READ_ROLE_BOOL BOOLEAN := FALSE;
	V_READ_ROLE_CODE VARCHAR2(50);

	v_arr apex_application_global.vc_arr2;



BEGIN

	SELECT (SELECT OPTION_VALUE FROM CC_CONFIG_OPTIONS WHERE OPTION_NAME = 'CAS_APP_CODE'), (SELECT OPTION_VALUE  FROM CC_CONFIG_OPTIONS WHERE OPTION_NAME = 'CAS_ADMIN_ROLE'), (SELECT OPTION_VALUE FROM CC_CONFIG_OPTIONS WHERE OPTION_NAME = 'CAS_WRITE_ROLE'), (SELECT OPTION_VALUE FROM CC_CONFIG_OPTIONS WHERE OPTION_NAME = 'CAS_READ_ROLE'), CAS_AUTH_APP_PKG.CAS_ROLE_CODE_LIST_FN (:app_user) INTO V_APP_CODE, V_ADMIN_ROLE_CODE, V_WRITE_ROLE_CODE, V_READ_ROLE_CODE, V_CAS_ROLE_CODE_LIST FROM DUAL;

	v_arr := apex_util.string_to_table(V_CAS_ROLE_CODE_LIST);
	for i in 1..v_arr.count
	loop
		IF ((v_arr(i) = V_WRITE_ROLE_CODE) OR (v_arr(i) = V_ADMIN_ROLE_CODE) OR (v_arr(i) = V_READ_ROLE_CODE)) THEN
			V_APP_READ_ROLE_BOOL := TRUE;
		END IF;
	end loop;

	RETURN V_APP_READ_ROLE_BOOL;
END;




Version 1.0 App Updates: (2 weeks)

	(1 week)
	X implement APEX feedback form
	X Implement the AAM user interface for managing user permissions
	X implement template app updated code
	X implement synonyms and automated application deployment
	X implement data write and data admin roles
	X reduce unnecessary logging

	(1 week)
	X upgrade app to use interactive grids instead of interactive reports, etc.
	_ implement database upgrade and rollback SOP (1 week)


_ remove auth user or change to readonly?


X update the DVM testing documentation for the automated method
	X Go to SQL directory and run sqlplus /nolog and then provide the hostname/user/pass and
	X check the automated directory using winmerge or diff program (using fc as a native Windows command line program)
	Maybe change the "-2" file name suffix to "-compare"

	X script winmerge or other diff tool to compare the files and output to a single file, which can then be diff'd with a saved file to confirm everything works properly

X DB Updates (1 day):
	X DVM
	X DLM
	X DPM (APEX use case)


Documentation:
	X DB documentation (DB modules upgraded and uses DB Module Packager project)

Test (1.5 weeks)
	_ DVM (automated test cases) - 3 days -> update the automated verification method to spool the output to a given directory (SQLPlus script to produce the same output
	Maybe even script the diff comparisons and check the output


	_ APEX app - 3 days



** X User Permissions (document this policy in the business rules document)
	X Data Admin can do anything
	X Data Write can add/edit/delete cruises, cruise legs, presets but not reference tables (X document the bus rule)




 3.5 weeks (could go more quickly -> need to get started and I'll update estimate as I make progress)




_ Data Integration SOP:
	Include scripts/functions for integrating directly with cruise data in addition to the existing cruise legs


X document business rules for the delete, update, insert actions (automatic overlap checks)

DVM configuration:
	_ update the description template to remove the cruise dates as these will change as associated cruise legs are modified

X CCD_DVM_PKG procedure for deleting DVM records (implement in CRDMA in "Delete DVM Recs" Process)
	X CCD_DVM_PKG procedure to query for all overlapping cruises before deletion and then batch DVM execution on all overlapping records after the record is deleted

X update the procedure definitions for CCD_DVM_PKG and CCD_CRUISE_PKG

X cruise leg delete bug in the APEX app (did not have the TO_NUMBER() data type conversion for the overloaded procedure definition)

_ document the business rules for the reference tables and presets/preset options

X CRDMA test cases for the CCD_CRUISE_PKG and CCD_DVM_PKG

_ QC view for orphaned DVM_PTA_ISSUES records (not associated with a CCD_CRUISES record)


X package documentation updates (compile and reference the applicable business rules):

	X CCD DVM Documentation.md X
	X CCDP Documentation.md X
	X CRDMA CCDP Testing Documentation.md (finish up the SOP portion) X
	X CRDMA DVM Testing Documentation.md (work on test cases and SOP, etc.) X
	X CCDP Testing Documentation.md (X update to indicate which sheets are used in which test cases and rename the sheets) X
	X Centralized Cruise Database DVM Testing Documentation.md X
	X Centralized Cruise Database - Technical Documentation.md X
	X Cruise Data Management Application - Technical Documentation.md X
	X Cruise Data Management Application - End User Documentation.md X
	X Cruise Data Management Application - Testing Documentation.md X

_ **Maybe some of the stuff in DVM category 1 can be integrated into the CRDMA validation and then in QA testing
	_ probably only the cruise name - fiscal year validation is feasible
	_ high cruise DAS/length is probably not feasible from the view/edit cruise leg page


X ** ensure all testing SOPs make it clear that this is not intended for production use -> only on dev and test where the data loss is not a problem



X bug with redirect warning on deep copy:
	X look to see if we can use apex.navigation to resolve the issue -> it only occurs when there has been interaction with the form even if it's only to navigate using the tabbed container

future plans:
	_ CRDMA - another view to help schedule ship time (be able to see some type of Google Calendar type of view to show overlaps of vessel legs/cruise legs).  Maybe allow the cruise leg dates to be updated in one unified interface.  Perhaps even adjust the dates with a slider with warnings/errors for conflicts.  Maybe even implement business rules for warnings/errors where there is a short/no in-port between cruises



X CCD_CCDP_DEEP_COPY_CMP_V has an error after running the test cases and v0.26 upgrade



Documentation consolidation:
_ Update the testing documentation to generalize it so the CCD and DVM packages can share the SOP (CCDP, CDVM in both the backend and the CRDMA tests - there is a lot of repetitive information)









X delete cruise test cases (automated error handling and processing test cases)

X update cruise leg test cases procedures (for identifying the pre and post update overlaps and executing the DVM accordingly)
 	X automated error handling and processing test cases (modify the existing ones and add more if necessary)


_ CRDMA tests for:
	_ CCD_DVM_PKG
	_ CCD_CRUISE_PKG



_ QC validation:
	_ No legs for a cruise
	_ time between legs over a certain number of days - unusually long or invalid (warning and error)




APEX Application

X DVM error annotation page
X DVM report page
X Cruise database data management page
X Cruise database report pages
	X cruise summary per year
	_ activity summary per cruise (list page with all cruise activities) - allow filtering by cruise
	_ allow searching by activity or data product

_ allow uploading/viewing of cruise instructions
_ Phase 2-3: spatial components, bounding box, search for research activities
_ bounding box -> range for individual sites
X ICAM
	All users have view-only access, specific people can edit
VPASS integration? (allocation) making the actual ship request - Nori will get me access to pull data
FINSS - https://www.st.nmfs.noaa.gov/finss/si/siMain.jsp

X Bug - Load view/edit cruise page with invalid ID still allows edit/delete, etc.

Database Update:

_ Add Operational Information
	cruise - description, start port, end port, chief scientist, DOI - X View to get min/max dates to pull full cruise date range
		X cruise legs (e.g. HA1201 LEG III)
		X cruise leg region(s)
		X regions (store polygon, coordinates, etc.)
			_ islands (store polygon, coordinates, etc.)


	science party - name, role, affiliation
	X data sets - specific instances on specific cruises that references the data set types record
		X data set types (e.g. MOUSS video, CTD, water samples, coral belt, fish REA, etc.) - pull suitable categories from NCEI/NMFS
			X data sets collected (description, data set type, etc.), DOI, link to data set, link to documentation, link to NMFS metadata, POC info, etc. - link to application for accessing the data directly (e.g. Reefbox)
					X unique key constraint on data set type and cruise/cruise leg

				_ data products (e.g. biomass, richness, stereo video, coral cover, etc.) - Unique key constraint on data set and data product type
				_ data set products (date available, access url, etc.)



				_ cruise participants (phase 2)
					_ participant permissions
					_ participant checklist (requirements including how often/timeframe)
				_ cruise chief scientist


				X data set status (e.g. not collected, collected, processed, data products available, publicly accessible, archived)
	track pre- and post-cruise activities


	X create a function that can easily be used by a given external schema to match a given cruise leg alias so it can be associated with a given cruise leg alias record (CRUISE_PKG.LEG_ALIAS_TO_CRUISE_LEG_ID)



Questions:





_ tabular form for the SOD data administrator to update the requirements for all cruise participants (TB, conduct, etc.) - allows the updating of multiple participants' information concurrently


_ add/edit cruise page should also contain a tabular form with one record by default with the ability to add multiple cruise legs at the same time

_ should we go with a more generic "Mission" database and each mission would essentially be a cruise and there would be a type field that would have values like NOAA Cruise, Nearshore Mission?


_ auditing fields and history package on all operational data tables

X re-define views on CCD DB

X grant statements for CEN_CTD schema

Misc:
	I could give a piece of project to Kimberly, she will generate GIS layers and populate data model
	test best practices for data model
	shape files from cruise activities -> standardizing these data products
	point locations in DB for surveys
	how to define working areas?
	QC the region polygons for summary locations
	historic sites -> proximity (e.g. CTD stations)
		CTD historic sites could be indicated by text column for historic/not historic in the short term
	participant list is in phase 2
		Participants could be pulled from Peachy (non-confidential)
		Ship profile for people - non-public info: TB info, MAC address, food restrictions, IT security awareness
	associate data sets at the program level
	chief scientist and POC for data defined per cruise


External User/Group management (request if the CEN_CRUISE schema can be granted select access to a non-confidential view that has user (first, last, email) and group information (div/prog) that can be used to
	_ look into modifying the auth app views so that they use these tables for authentication/authorization so these don't need to be maintained separately.  Also need to assign admin privileges for specific SOD staff to be able to change anything in the DB


DVM QC Criteria:
X same ship cannot have concurrent cruises
X missing field values
X date criteria (start/end dates, etc.)
X regex for the cruise name to make sure that the cruise name (e.g. SE-15-01) is in the same federal fiscal year as the departure or end date


_ RSS feed functionality - subscribe to a cruise leg's data set or type of data set/stream for all updates or just when ready for download

_ utilize roles to grant the set of object permissions necessary to integrate the CCD into a given data set.  But this is problematic because roles are not enabled by default when executing PL/SQL code.  This needs more research




VPASS
	Logged in as a PI.  Could create a new ship request but couldn't see anything in the instructions to allow importing of ship requset data.
	Can pull reports and filter by FY and project name (e.g. PIFSC) but there is no option to download the approved ship requests only so they can be exported to the CCD.  You can also sort as well but the data for exporting cruise information is not readily accessible.
		Closest thing to being able to import a record seems to be copying an existing record in the system
	Can export ship time requests as a .xlsx
		VC Status seems to indicate if the project was approved or not (e.g. Certified by OU VC & Submitted to LO REP)
		X look at fields to see which should be added to the Cruise/Leg tables (some of the fields displayed in the interface are not populated in the .xlsx export - e.g.  start date, end date, Org Unit 1, Piggyback Notes)
			Some fields are shown on the searching interface and not in the Excel sheet (e.g. VC Status) and vice versa (e.g. staging port, staging day, staging day from, destaging port, destaging day, )




FINSS (planning system and reporting system)
	Logged in
	Survey Instrance Reports:
		Can filter the PIFSC cruises and then export as CSV file.  The CSV file does not contain the cruise dates.  This does contain valuable information like Categories, Gear, Vessels, days at sea, survey name, number of legs, etc.
	Survey Instance Records:
		Can filter the PIFSC cruises but there is no option to export the data.  Cannot export the data from the Survey instance search but it does contain information like Cruise dates in the Survey Cruises column.  But there is no way to readily export the data and import it into the CCD.  The cruise information is concatenated into a single field but this field could be parsed if it was available electronically.  Only other option is to copy and paste the dynamic HTML and then parse it using other means (e.g. programmatically but this is not recommended because this import process will need to change each time the interface changes).  Perhaps we could request a data dump for the PIFSC projects annually/periodically?
		Can export KML (look into this more)



	Data elements:
		Legs (called cruises in FINSS) - Leg Start/End date, days at sea (calculated), Platform Type (LOV), Vessel(LOV), Regional Ecosystem(LOV), Gear(LOV), Project Name in VPASS, Standard Survey Name (LOV),
		Cruise (called survey instance in FINSS) - Center (LOV - should always be PIFSC), FY, Survey Frequency (LOV), Survey URL, Survey Contact Email, Primary survey category (LOV), Secondary Survey Category (LOV), Target Species - ESA (LOV), Target Species - MMPA (LOV), Target Species - FSSI (LOV), Target Species - Other Species (LOV), Expected Species Categories (LOV), Comments


	SQL code to calculate the numer of days at sea (document this and define in CEN_TOOLS_PKG or CRUISE_PKG pkg)
		ex: select TO_DATE('20-JUL-19', 'DD-MON-YY') - TO_DATE('06-JUL-19', 'DD-MON-YY') + 1 from dual;

	Phase 2
		Maybe allow preferences to be defined (e.g. ESD CRCP cruises automatically select the coral species of interest and then they can modify to streamline and provide templates





Ask Nori the intent of the CCD with respect to FINSS and VPASS - there is no import functionality so not sure how we would use the CCD other than to import the information from the other NOAA systems to populate the CCD.



_ rename package CCD_PKG instead of CRUISE_PKG


_ review the CTD app for features to implement (tooltips, downloads, etc.)
	_ tooltips (_page 230)

X default the sci center to PIFSC
X default the survey type to NMFS Survey


_ summary reports for the home page
	_ (broken down by division/program, survey name, ) total number of days at sea, total number of cruises, cruise legs

	_ dynamic reports?  Choose fields to group on and values to filter on (charts e.g. by region, regional ecosystems, target species, etc.)


	X highlight background of the specific regions to show the active forms so people know what is available in a given window.	(_ document best practice)


	X conditional QA on the standard survey name

** _ document that the fiscal year is a field in FINSS but this can be automatically determined by the associated leg dates


X reference table lists/form (build out examples)


X add leg regions



How to implement presets (e.g. gear preset, target species, etc.) and how to handle in the interface -
	either
		X a shuttle field (no reason to specify multiple values, should just be a picker field
		X or a interactive grid (not necessary since it's just a way to choose existing options)

X create a link back to the view/edit cruise page from the view/edit cruise leg page

X rename view/edit to view/update

X implement presets for cruise-level information


_ add information in the documentation and on the page to indicate that the yellow background indicates active forms that can be used to add/edit database records
_ implement a view extended information tab for viewing all information in summary for the given cruise or cruise leg
_ tool tips for preset classic reports

**_ need to maintain the relative order of the different cruise options?

X package function to take the nth value in the delimited list (can even specify the delimiter if you want) - defined in the CEN_UTILS.CEN_UTILS_PKG




X populate DVM QC criteria for DB to determine when there are cases that should be reviewed
	X implement the review/annotation system

_ tooltips on the tabs in each of the view/edit Forms
_



_ *****document the best practices in the interface (e.g. tooltips, tabbed navigation, presets, etc.)



_ document business rule for standard survey name other field (CCD_CRUISES.CTD_SURVEY_NAME_OTH) and how the STD_SURVEY_NAME_ID fields should be mutually exclusive (one or the other with precedence to foreign key)
	X implemented in Views
_ document business rule for CCD_CRUISE_SURVEY_CATS.PRIMARY_YN field and how it is implemented in the application (filtered into two categories based on flag)
	X implement in Views

X document the business rule for automatically evaluating the overlapping cruises when using the overlap CCD_DVM_PKG package procedure
	X update the DVM documentation to reference this overlap procedure as a new use case example
X document the business rule for in-port surveys/data collection activities (reference Nori's explanation about shore based missions from meeting on 8/24/20)



**X fix FY 2099 problem with TC9905 (this was due to the two-digit year defaulting 99 to 2099 instead of 1999)
X view cruise legs interactive report/classic reports are in sync (3/25/20) including columns and comments

_ unsaved changes warning when leaving page without saving (e.g. edit cruise leg link)
X CCD_SVY_CAT_PRE_V delimited view and form/report



Reference tables:
X CCD_SVY_FREQ
X CCD_SVY_TYPES
X CCD_TGT_SPP_ESA
X CCD_TGT_SPP_FSSI
X CCD_TGT_SPP_MMPA
X CCD_SVY_CATS
X CCD_STD_SVY_NAMES
X CCD_SCI_CENTERS
X CCD_REGIONS
X CCD_REG_ECOSYSTEMS
X CCD_PLAT_TYPES
X CCD_GEAR
X CCD_VESSELS
X CCD_EXP_SPP_CATS

X action processed notification on simple reference table modular windows when insert/edit/update occurs


_ filtered lists functionality (many-to-many) _ change to checkbox instead of y/n select field
X ESA
X FSSI
X MMPA
X gear
X expected species categories
_ primary survey categories
_ secondary survey categories
X regional ecosystems
regions



X filtered lists functionality (one-to-many)
X Vessels
X standard survey names


X add cruise fields:
	X description
	X Org - PIFSC Division (child of CCD_SCI_CENTERS)
	X Objective Based Metrics


**_ need to figure out how to deal with the presets if the selected value is not included in the shuttle field (add it to shuttle field?? - yes)


_ copy cruises and cruise legs
	X figure out how to copy the other species and leg aliases into the pending other species records:
	X cruise
	X leg
	_ cruise (deep copy)
		X handle the leg alias names by adding (copy) at the end of them
		X tooltip for the Deep Copy button so it is clear what this button does (warn about unsaved changes and that the saved changes are the ones that will be copied, unsaved changes will not be included)
		_ confirm dialog for the deep copy action
		use cases:
			X cruise (copy) already exists
			X cruise leg (copy) already exists
			X cruise leg alias name (copy) already exists
			X cruise only (no legs)
			X cruise only (no legs, no attributes)
			X cruise and legs (no cruise attributes)
			X cruise and legs (no leg attributes)
			X cruise and legs (cruise and leg attributes)
			X cruise doesn't exist
X switch leg attributes to use y/n checkboxes

_ implement deep copy in the interactive report (Page 210) as well

_ validation -
	X QA X QC legs can't have overlapping dates for the same cruise
	X QA X QC vessels can't have two concurrent legs
	X look for cruise/legs with names containing "(copy)" as this should not naturally occur in the data
	DAS/Cruise Length:
		X need to implement the secondary warning only if there is error:
		X warning where a cruise leg is more than 30 days?
		X warning where a cruise is more than 120 days?
		X cruise name validations
		X cruise name fiscal year and cruise fiscal year mismatch
		_ store ship name and validate cruise name has the appropriate abbreviation (this is problematic since one cruise can have multiple vessels)
	attribute validation
		X cruise without primary objective?
		X cruise leg without gear?

_ transactions in cruise and cruise leg processing

X add the reference table management page for science center divisions

X tooltips on the report pages for the filtering select fields

X show validation errors in a different pane so it can be viewed and addressed
	_ link to APEX application pages with the corresponding IDs
		for each QC view it can refer to a given page number, and page parameters so it has the information APEX needs to generate the URL
		maybe this should be defined in the DVM_QC_OBJECTS records? -> yes (define APEX page ID, APEX page parameters, and table name which can be used in a case statement to determine which field should be used)
			_ how to figure out which field values to use when generating the URLs (e.g. CRUISE_ID vs. CRUISE_LEG_ID but also which CRUISE_LEG_ID should be used when the errors are associated with the parent, not the corresponding child record?)
		DVM error type is used to generate DVM Errors (error records linked to CCD_CRUISES record)
			_ **Use the placeholder approach for constructing the necessary pieces of the URL and the rest of it can be determined at runtime like APP_ID and session id


X Implement the error report/annotation functionality in APEX
	X View/Edit Cruise
	X QC Validation Issues

X add accessor DVM functions into CCD_CRUISE_PKG so it already has the CCD defined for it

X execute the validation module each time a cruise record is saved or cruise leg is saved or deep copied

DVM
	X implement the duplicate check that was developed for CTDs so we ensure that the error will exist on both sides

X update the QC Criteria and update/verify the test cases

X Update the business rules documentation

X tooltips on the different tabs in pages 220 and 230


X document issue categories in business rules (part of core DB)


_ document how the batch execution DVM SP can be used to validate data before it is used for analysis and formal reports (perhaps before it is migrated to the live schema vs. staging data only accessible to some authorized users)
	_ do this in the DVM module documentation and provide example code that they would then develop a simple query so they can loop through all parent records they want to and they can constrain the result set for flexibility


X Implement the QA criteria

X Testing documentation for QA criteria

X testing documentation for the CRDMA

X bug fix: when the onload warning fires it removes any success message so it is not visible at all

		
		
		
		
		

_ reports by division
_ reports by vessel



_ separate javascript code into include file functions
	X view/edit preset pages
_ separate css code into include files



_ add field to summary report or create a new summary report that contains a count of how many of each type of validation issue is associated with the given cruise and a boolean for valid/not valid

X change Y/N to Yes/No select fields (primary category for survey category presets)
X implement links in the QC report (standalone page only) to link the cruise name to the corresponding view/edit cruise


X tooltip for delete button on the 220 and 230 to inform the user that the related records will prevent the cruise or leg from being deleted
X tooltips for preset delete buttons to indicate that the preset options must be removed before deleting these presets otherwise it will throw an error (otherwise you can always delete a preset record)

X valid cruise indicator (color coded?) with counts for annotated errors, etc.

**_ qc queries for orphaned DVM records (DVM view)


_ export calendar information (e.g. Google Calendar format, outlook, thunderbird, etc.)

X insert/update/delete cases for cruises in the testing documentation ->
	X ensure that the attributes are processed first in the processing order for deletions
		X delete cruise must remove all associated DVM error records before deleting the cruise
	X ensure that the attributes are processed after the cruise update/insert for new/updated cruises


X business rules:
	X when a cruise is deleted the PTA error recs associated with it are deleted

X (look into the settimeout version to ensure that the tabular form is loaded before populating it)
	X applied fix to P220 and P230 (5/5/20) using setTimeout
		X other species javascript for the copy cruise functionality is buggy (not consistent)
		X leg aliases javascript for the copy cruise leg functionality is buggy (not consistent) -> reloading page seems to resolve but this is problematic because people can save everything without realizing they need to define the leg aliases manually
	** _ maybe even check to see if it's loaded and then if not do another setTimeout loop until it executes and set a boolean or hard exit)

_ QA for valid email address

Gameplan (5/6/20):
	X test the JS code for the ajax other species and leg aliases request/population code to make sure it works.
		X Document the bug fix, document the fix,
	X implement the valid/invalid cruise indicators in the reports and summary pages, document the update,
	X update the documentation and commit the code, push the code, deploy the code to MIDD/MIDT
	X do we need to re-evaluate the validation - no (the only things that will change will not be functional, I've already tested the functionality on 220, 230 on 5/5/20)


_ create a view for returning all cruise information and related DVM issues
X QC Validation Issues Reports
	X implement default sorting for the QC validation issues
	X make sure the field order on all QC vaidation reports is the same
X add QC validation issues data grid to View/Edit Cruise Legs



(7/1/20) Meeting Feedback:
Kyle - Not having much involvement in creation of cruises/cruise legs

Kristin - Suggestion: X (ended up labeling each of the charts in the interface) cruise summary cover page (description of what we are looking at)

Number of cruises and
(_ color coding - cruise summary page - color code the bars on the reports - or maybe a different way to show it)
(Easier on the eyes)


X Possible Bug: following deep copy did not report the overlap errors for the associated legs in the DVM


8/17/20 feedback from RR:

I just looked at the validation rules. They seem good to me!

I don't know how historical records may have been (cruises from long ago), but recent cruises are divided into legs that usually don't exceed 35 days.  (The maximum duration of our ships is 30-35 DAS before they need to reprovision.)  The fact you have it warning on legs longer than 30 days is good.

I assume in-ports are counted as part of an overall cruise length, but not as part of an individual leg.  (An entire cruise would consist of individual Legs (DAS) and in-ports, as applicable.)

What happens if work was done during an in-port? I know we had an ASRAMP or two where that happened.  It was definitely the exception and not the rule, but in thoseoccasions data was collected that was not during a DAS (cruise leg). Does that matter at all for this?

My response:

I'll leave the 30 days at sea warning in place for cruise legs.  The data system will currently not allow cruise legs to exceed 90 days at sea, should this be adjusted to 45 or is there a more reasonable number you could recommend?  Also, yes in-ports between legs are included as part of the overall cruise length.

That's a good point, I recommend that the in-port work be attributed to the previous leg in the event that there is work done in-port following the last leg of a cruise.  I have documented the pending cruise data system business rule for in-port work to ensure we are consistent moving forward.
